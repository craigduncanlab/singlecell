---
title: "Seurat_BroadIntro"
author: "Craig Duncan"
date: "06/04/2021"
output: html_document
---

# Introduction to single cell, gene expression analysis

THe Seurat package is used by scientists who are investigating biological processes, using data that sequences the amount of genetic material (RNA) present in a laboratory experiment.   This genetic material is called 'expression data', and the analysis of this is a type of data analysis within the field of bioinformatics.   The work being done is best described as 'gene expression analysis', using data obtained from single-cell sequencing processes.  However, this is often lazily called 'single cell analysis'.  To more accurately describe this in a way that any data analyst can understand, we need to remember that the data set is a set of gene-based rows, with counts per cell.  

Even this gene-expression data has to be derived, in a complex procedure, from what sequencing machines produce. It is a significant step in itself to prepare the 'count matrices' (which are, more correctly, gene-v-cells count matrices) from the output of a sequencing machine, based on a laboratory-prepared experiment.  The conversion of raw sequencing data to expression data is not a step that should be taken lightly.  It is only the first step in the data analysis of 'gene expression' data, and is an end in itself: it is the fundamental 'raw data' to the gene expression data analyst.  These matrices may have hundreds of genes, and thousands or millions of cells.  Even working out how to store them in a computer (using a 'sparce matrix' rather than a fully represented grid) is an exercise in itself.

The Seurat package is a non-commercial software package for the R language, whose principal offering (but not its only benefit) is the ability to create 'Seurat objects' in the R language, for scientists who wish to perform gene expression analysis.  "Seurat was originally developed as a clustering tool for scRNA-seq data" per [SVICambridgeCourse](https://biocellgen-public.svi.edu.au/mig_2019_scrnaseq-workshop/public/seurat-chapter.html)

By 'clustering tool', the authors mean a visualisation tool that will help scientists to represent, in just two dimensions, the underlying similarity or *variability* of the gene expression data for the cells in the experiment (with respect to the other cells).  True variability, on such a simple basis, is not immediately apparent in the data, and the relationships between thousands of cells may be complex.  A clustering tool is, however, something useful that can be implemented near the end of the down-stream analysis.   Preceding steps to prepare the data (already in the form of genes per cell counts) still need to be done, drawing on statistical knowledge, as it would for any general data analysis.

Seurat offers one way of working with (performing statistical analysis upon) this data, in which there is a custom 'Seurat object' at the centre of the analysis.  The Seurat 'ecosystem' is based on the R programming language and its custom 'Seurat object', but even this is different to the Bioconductor 'ecosystem', also based on the R language, but using its own custom 'SingleCellExperiment object'.  Both these software worlds work with the same general set of single cell (expression) data, and many of the same scientific goals and steps.  Much of the general knowledge for single cell analysis can be used interchangeably to work with these two packages, yet the software setup, and the precise scripts and code for Seurat and SingleCellExperiment objects will be slightly different.  It is possible to convert data from a Seurat object to a SingleCellExperiment object.  Aside from these two software ecosystems, there are other ways, to analyse the single cell data, drawing more broadly from the R and python ecosystems.  If you understand what the data is, and how it was obtained, you can even use basic R and statistical functions, for discrete steps.  The larger packages like Seurat and the Bioconductor tools are designed to reduce labour and time.

Some general data analysis methods will always need to be applied to the single cell data, even before specific dimension reduction and clustering methods are used.  These include quality filtering, and also 'normalisation' (transforming the data so that it can be compared to other data sets, regardless of the size, or specific variance of the data).  

Normalisation often involves adjustments to individual data entries that take into account the range, and the mean of the raw data, and then returning a modified set of data that fits certain desired properties (like a mean of '1' for the counts, but prepared on a float basis: this need to scale is why the data type for the Seurat 'nCount' is 'numeric' and not an integer, as noted later).

Even before PCA is attempted, some attempts at simplifying and organising the data can and should be made.  Some genes form sets of variability, but within these, some genes are more variable than others, around some average variability for that set (or 'bin').   The notion of 'high dimensions' here is the fact that each gene can be compared to its variability to some other gene, but as there are thousands or millions of genes, this becomes an extremely complex interaction to describe statistically, let alone visualise.  

Find an optimal way to visualise this variability in the most optimal way for 2 dimensions involves iterative attempts to optimise certain statistical parameters, and intermediate steps to construct sub-sets of cells that are more alike in their gene expression.   These techniques involve what is called 'machine learning', and specifically, gradient descent is often employed.   

Some of the ground work for the methods of dimension-reduced visualisation was done over a decade ago, outside the single cell context:  van der Maaten, L., and Hinton, G. (2008). Visualizing Data using t-SNE. Journal of Machine Learning Research 9, 2579-2605.  This work followd on from the Stochastic Neighbour Embedding (SNE) work done earlier, in 2002, by Hinton and Roweis.

Both SNE and Principal Components Analysis are techniques for representing data in lower dimensions, but we'll see that using PCA in combination with SNE or t-SNE produces more useful results for single cell analysis.  That is, you can do some work to reduce dimensions in PCA even before applying the t-SNE methods that result in a 2D representation of the cells.

Once visualisation has been done, some retrospective identification of the cells, based on genes that might be activated, is usually undertaken (check that Seurat does it this way, rather than reverse).  The identification of these 'marker genes' (that mark the cell types we might have detected) is discussed, in the context of a non-Seurat workflow, [here](http://bioconductor.org/books/release/OSCA/marker-detection.html)
